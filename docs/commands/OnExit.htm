<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>OnExit</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="../css/default.css" rel="stylesheet" type="text/css">
</head>
<body>

<h1>OnExit</h1>

<p>Bestimmt eine <a href="Gosub.htm">Subroutine</a>, die automatisch ausgeführt wird, sobald das Script beendet wird.</p>

<pre class="Syntax">OnExit [, Label]</pre>
<h3>Parameter</h3>
<dl>

  <dt>Label</dt>
  <dd><p>Ist dieser Parameter nicht vorhanden, wird das Script wieder normal beendet. Ansonsten kann der Name eines <a href="../misc/Labels.htm">Labels</a> angegeben werden, dessen Inhalt beim Beenden des Scripts ausgeführt wird (als neuer <a href="../misc/Threads.htm">Thread</a>).</p></dd>

</dl>

<p><strong>WICHTIG</strong>: Da statt Beenden des Scripts die angegebene Subroutine aufgerufen wird, muss in der Subroutine der <a href="ExitApp.htm">ExitApp</a>-Befehl verwendet werden, falls das gewünscht ist. Alternativ (wie in den Beispielen weiter unten) kann die OnExit-Subroutine eine <a href="MsgBox.htm">MsgBox</a> anzeigen, um die Bestätigung des Benutzers einzufordern - nur wenn der Benutzer JA drückt, würde das Script ExitApp ausführen, um sich selbst zu schließen.</p>
<h3>Bemerkungen</h3>
<p>Die OnExit-Subroutine wird aufgerufen, sobald das Script in irgendeiner Form beendet wird (es sei denn, das Script wird mit einer gewaltsamen Methode beendet, wie z. B. "Task beenden"). Diese Subroutine wird auch aufgerufen, sobald die Befehle <a href="_SingleInstance.htm">#SingleInstance</a> und <a href="Reload.htm">Reload</a> eine vorherige Instanz auffordern, sich zu beenden.</p>
<p>Mit <code><a href="OnMessage.htm#shutdown">OnMessage(0x11, "WM_QUERYENDSESSION")</a></code> kann das Herunterfahren oder Abmelden des Betriebssystems erkannt und optional abgebrochen werden.</p>
<p>Der OnExit-<a href="../misc/Threads.htm">Thread</a> ignoriert <a href="_MaxThreads.htm">#MaxThreads</a> (er wird immer gestartet, wenn nötig). Darüber hinaus kann dieser bei der Ausführung nicht von einem anderen <a href="../misc/Threads.htm">Thread</a> unterbrochen werden, einschließlich <a href="../Hotkeys.htm">Hotkeys</a>, <a href="Menu.htm">benutzerdefinierte Menüpunkte</a> und <a href="SetTimer.htm">zeitlich festgelegte Subroutinen</a>. Allerdings wird der Thread unterbrochen (und das Script beendet), wenn der Benutzer den Menüpunkt Exit im Tray-Menü oder Hauptmenü auswählt, oder das Script aufgrund von <a href="Reload.htm">Reload</a> oder <a href="_SingleInstance.htm">#SingleInstance</a> beendet wird. Deshalb sollte die OnExit-Subroutine schnell zum Ende kommen, solange dem Benutzer nicht bewusst ist, was er tut.</p>
<p>Wenn der OnExit-<a href="../misc/Threads.htm">Thread</a> auf einen Fehler wie z. B. Laufzeitfehler stößt, wird das Script beendet. Dadurch wird verhindert, dass das Script aufgrund einer fehlerhaften OnExit-Subroutine nicht mehr beendet werden kann.</p>
<p>Falls die OnExit-Subroutine aufgrund eines <a href="Exit.htm">Exit</a>- oder <a href="ExitApp.htm">ExitApp</a>-Befehls aufgerufen wurde, bei dem ein Exitcode angegeben worden ist, wird dieser Code ignoriert und nicht länger zur Verfügung stehen. Die OnExit-Subroutine kann einen neuen Exitcode bestimmen, indem sie <a href="ExitApp.htm">ExitApp</a> aufruft.</p>
<p>Sobald die OnExit-Subroutine von einem Exitversuch aufgerufen wird, beginnt diese mit den Standardwerten in Einstellungen wie <a href="SendMode.htm">SendMode</a>. Diese Standardwerte können im <a href="../Scripts.htm#auto">automatischen Ausführungsbereich</a> geändert werden.</p>
<p>The built-in variable <strong>A_ExitReason </strong>is blank unless the OnExit subroutine is currently running or has been called at least once by a prior exit attempt. Dabei enthält sie eins der folgenden Wörter:</p>
<table class="info">
  <tr>
    <td>Logoff</td>
    <td><a name="logoff"></a>Der Benutzer meldet sich ab.</td>
  </tr>
  <tr>
    <td>Shutdown</td>
    <td>Das System wird heruntergefahren oder neu gestartet (z. B. mit dem <a href="Shutdown.htm">Shutdown</a>-Befehl). </td>
  </tr>
  <tr>
    <td>Close</td>
    <td>Das Script hat eine WM_CLOSE- oder WM_QUIT-Nachricht empfangen, hatte einen kritischen Fehler, oder wurde auf andere Weise geschlossen. Obwohl alle von denen ungewöhnlich sind, könnte <a href="WinClose.htm">WinClose</a> die Ursache für WM_CLOSE sein, falls dieser Befehl auf das Hauptfenster des Scripts angewendet wird. Um das zu verhindern, sollte das Hauptfenster mit <code>Send, !{F4}</code> geschlossen werden.</td>
  </tr>
  <tr>
    <td>Fehler</td>
    <td>A runtime error occurred in a script that is not <a href="../Scripts.htm#persistent">persistent</a>. Ein Laufzeitfehler tritt zum Beispiel auf, wenn <a href="Run.htm">Run/RunWait</a> nicht in der Lage ist, das angegebene Programm oder Dokument zu öffnen.</td>
  </tr>
  <tr>
    <td>Menu</td>
    <td>Der Benutzer hat Exit im Hauptfenster-Menü oder voreingestellten Tray-Menü ausgewählt.</td>
  </tr>
  <tr>
    <td>Exit</td>
    <td>Es wurden die Befehle <a href="Exit.htm">Exit</a> oder <a href="ExitApp.htm">ExitApp</a> verwendet (einschließlich <a href="Menu.htm">benutzerdefinierte Menüpunkte</a>). </td>
  </tr>
  <tr>
    <td>Reload</td>
    <td>Das Script wird über den <a href="Reload.htm">Reload</a>-Befehl oder -Menüpunkt neu geladen.</td>
  </tr>
  <tr>
    <td>Single</td>
    <td>Aufgrund von <a href="_SingleInstance.htm">#SingleInstance</a> wird das Script mit einer neuen Instanz von sich selbst ersetzt. </td>
  </tr>
</table>

<h3>Siehe auch</h3>
<p><a href="OnMessage.htm">OnMessage()</a>, <a href="RegisterCallback.htm">RegisterCallback()</a>, <a href="../misc/Clipboard.htm#OnClipboardChange">OnClipboardChange</a>, <a href="ExitApp.htm">ExitApp</a>, <a href="Shutdown.htm">Shutdown</a>, <a href="_Persistent.htm">#Persistent</a>, <a href="../misc/Threads.htm">Threads</a>, <a href="Gosub.htm">Gosub</a>, <a href="Return.htm">Return</a>, <a href="Menu.htm">Menu</a></p>
<h3>Beispiel</h3>
<pre class="NoIndent">#Persistent  <em>; For demonstration purposes, keep the script running if the user chooses "No".</em>
OnExit, ExitSub
return

ExitSub:
if A_ExitReason not in Logoff,Shutdown  <em>; Avoid spaces around the comma in this line.</em>
{
    MsgBox, 4, , Are you sure you want to exit?
    if A_MsgBoxResult = "No"
        return
}
ExitApp  <em>; The only way for an OnExit script to terminate itself is to use ExitApp in the OnExit subroutine.</em></pre>

</body>
</html>
