<!DOCTYPE HTML>
<html>
<head>
<title>Loop (Registry)</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex, nofollow">
<link href="../static/theme.css" rel="stylesheet" type="text/css" />
<script src="../static/jquery.js" type="text/javascript"></script>
<script src="../static/tree.jquery.js" type="text/javascript"></script>
<script src="../static/ga.js" type="text/javascript"></script>
<script src="../static/content.js" type="text/javascript"></script>
</head>
<body>

<h1>Loop (Registry)</h1>

<p>Ermittelt nacheinander den Inhalt des angegebenen Registry-Unterschlüssels.</p>

<pre class="Syntax">Loop, Reg, Hauptschlüssel\Schlüssel [, Modus]</pre>
<h3>Parameter</h3>
<dl>

  <dt>Reg</dt>
  <dd><p>Dieser Parameter muss das Wort REG sein, und darf kein Ausdruck oder Variablenverweis sein.</p></dd>

  <dt>Hauptschlüssel</dt>
  <dd><p>Entweder HKEY_LOCAL_MACHINE (oder HKLM), HKEY_USERS (oder HKU), HKEY_CURRENT_USER (oder HKCU), HKEY_CLASSES_ROOT (oder HKCR) oder HKEY_CURRENT_CONFIG (oder HKCC).</p>
      <p>Um den Zugriff auf eine Remote-Registry zu ermöglichen, muss der Computername und ein Schrägstrich wie im folgenden Beispiel vorangestellt werden:<br>  \\workstation01\HKEY_LOCAL_MACHINE</p></dd>

  <dt>Schlüssel</dt>
  <dd><p>Name des Schlüssels (z. B. Software\BeliebigeAnwendung). Ist dieser Parameter leer oder nicht vorhanden, wird der Inhalt vom <em>Hauptschlüssel</em> abgerufen.</p></dd>

  <dt>Modus</dt>
  <dd><p>Ein oder mehrere der folgenden Zeichen (keine Unterscheidung zwischen Groß- und Kleinschreibung), optional durch Leer- oder Tabulatorzeichen getrennt:</p>
      <p><strong>V</strong>: Ermittelt Werte, die dem Muster entsprechen. Dies ist die Standardeinstellung, wenn "D" nicht angegeben ist.<br>
      <strong>K</strong>: Ermittelt Unterschlüssel, die dem Muster entsprechen.<br>
      <strong>R</strong>: Geht rekursiv in die Unterschlüssel, so dass auch die darin enthaltene Werte und Unterschlüssel ermittelt werden.</p></dd>

</dl>

<h3>Bemerkungen</h3>
<p>Eine Registry-Schleife ist nützlich, wenn mehrere Werte und Unterschlüssel nacheinander bearbeitet werden sollen. Die Werte und Unterschlüssel werden in umgekehrter Reihenfolge abgerufen (von unten nach oben), damit <a href="RegDelete.htm">RegDelete</a> ohne Unterbrechung innerhalb der Schleife verwendet werden kann.</p>
<p>Die folgenden Variablen können nur innerhalb einer Registry-Schleife verwendet werden. Wenn eine innere Registry-Schleife von einer äußeren Registry-Schleife umschlossen ist, wird der Eintrag von der innersten Schleife Vorrang haben.</p>
<table class="info">
  <tr>
    <td>A_LoopRegName</td>
    <td>Name des aktuell ermittelten Eintrags, der entweder ein Wertname oder der Name eines Unterschlüssels sein kann. Der im Registrierungs-Editor angezeigte Wertname "(Standard)" wird abgerufen, wenn ihm ein Wert zugewiesen wurde - A_LoopRegName selbst wird aber leer sein.</td>
  </tr>
  <tr>
    <td>A_LoopRegType</td>
    <td>Typ des aktuell ermittelten Eintrags, der eins der folgenden Wörter sein kann: KEY (bedeutet, dass der aktuell ermittelte Eintrag ein Unterschlüssel ist, aber kein Wert), REG_SZ, REG_EXPAND_SZ, REG_MULTI_SZ, REG_DWORD, REG_QWORD, REG_BINARY, REG_LINK, REG_RESOURCE_LIST, REG_FULL_RESOURCE_DESCRIPTOR, REG_RESOURCE_REQUIREMENTS_LIST, REG_DWORD_BIG_ENDIAN (wahrscheinlich selten in den meisten Betriebssystemen). Diese Variable ist leer, wenn der aktuell ermittelte Eintrag ein unbekannter Typ ist.</td>
  </tr>
  <tr>
    <td>A_LoopRegKey</td>
    <td>Name des zurzeit verwendeten Hauptschlüssels (HKEY_LOCAL_MACHINE, HKEY_USERS, HKEY_CURRENT_USER, HKEY_CLASSES_ROOT oder HKEY_CURRENT_CONFIG). Beim Zugriff auf eine Remote-Registry enthält dieser Wert <strong>nicht</strong> den Namen des Computers.</td>
  </tr>
  <tr>
    <td>A_LoopRegSubKey</td>
    <td>Name des aktuellen Unterschlüssels. Ist das gleiche wie der <em>Schlüssel</em>-Parameter, solange der <em>Rekursiv</em>-Parameter nicht dazu verwendet wird, andere Unterschlüssel zu durchsuchen. In diesem Fall enthält die Variable den vollständigen Pfad des aktuell ermittelten Eintrags, ohne Hauptschlüssel. Zum Beispiel: Software\BeliebigeAnwendung\MeinUnterschlüssel</td>
  </tr>
  <tr>
    <td>A_LoopRegTimeModified</td>
    <td>Wann der aktuelle Unterschlüssel oder seine Werte zuletzt bearbeitet wurden. <a href="FileSetTime.htm">YYYYMMDDHH24MISS</a>-Format. Diese Variable wird leer sein, wenn der aktuell ermittelte Eintrag kein Unterschlüssel ist (d. h. <em>A_LoopRegType</em> ist nicht das Wort KEY).</td>
  </tr>
</table>
<p>Innerhalb einer Registry-Schleife können folgende Befehle auf einfachere Weise verwendet werden, um den aktuell ermittelten Eintrag zu bearbeiten:</p>
<table class="info">
  <tr>
    <td width="21%"><a href="RegRead.htm">RegRead</a>, AusgabeVar</td>
    <td width="79%">Liest den aktuellen Eintrag. Wenn der aktuelle Eintrag ein Schlüssel ist, wird Errorlevel auf 1 gesetzt und <em>AusgabeVar</em> leer gemacht.</td>
  </tr>
  <tr>
    <td><a href="RegWrite.htm">RegWrite</a> [, Wert]</td>
    <td>Schreibt in den aktuellen Eintrag. Falls <em>Wert</em> nicht vorhanden ist, wird der Eintrag je nach Typ auf 0 gesetzt oder leer gemacht. Wenn der aktuelle Eintrag ein Schlüssel ist, wird ErrorLevel auf 1 gesetzt.</td>
  </tr>
  <tr>
    <td><a href="RegDelete.htm">RegDelete</a></td>
    <td>Löscht den aktuellen Eintrag. Wenn der aktuelle Eintrag ein Schlüssel ist, wird dieser mit all seinen Unterschlüsseln und Werten gelöscht.</td>
  </tr>
</table>
<p>Beim Zugriff auf eine Remote-Registry (über den <em>Hauptschlüssel</em>-Parameter, wie oben beschrieben) gelten folgende Hinweise:</p>
<ul>
  <li>Auf dem Zielrechner muss der Dienst "Remote Registry" laufen.</li>
  <li>Der Zugriff auf eine Remote-Registry kann fehlschlagen, wenn der Zielcomputer nicht zur Domäne des Benutzers gehört oder der Benutzername nicht genügend Berechtigungen hat (siehe unten für mögliche Übergangslösungen).</li>
  <li>Abhängig von der Domäne, der Arbeitsgruppe und/oder den Berechtigungen kann es sein, dass sich der Benutzer mit einem freigegebenen Gerät erst verbinden muss (z. B. durch eine Laufwerkszuordnung), bevor der Remotezugriff auf die Registry erfolgt. Bei so einer Verbindung (mit Benutzernamen, Passwort und genug Berechtigungen zur Bearbeitung der Registry) könnte als Nebeneffekt der Remotezugriff auf die Registry aktiviert werden.</li>
  <li>Wenn der Benutzer bereits mit einem anderen Benutzernamen auf dem Zielcomputer angemeldet ist (z. B. als Gast auf ein zugeordnetes Laufwerk), dann kann es sein, dass der Benutzer sich erst abmelden muss, damit die Remote-Registry sich neu verbinden kann und den Benutzer wieder mit seinem eigenen angemeldeten Benutzernamen authentifiziert.</li>
  <li>Für Windows Server 2003 und Windows XP Professional heißt es in MSDN: "Wenn der [Server der Registry] Computer mit einer Arbeitsgruppe verbunden ist und die Sicherheitsrichtlinie <em>Einfache Dateifreigabe</em> aktiviert ist, dann schlägt die Funktion fehl. Beachten Sie, dass diese Sicherheitsrichtlinie standardmäßig aktiviert ist, wenn der Computer mit einer Arbeitsgruppe verbunden ist."</li>
  <li>Für Windows XP Home Edition weißt MSDN darauf hin, dass "diese Funktion immer fehlschlägt". In der Home Edition fehlt für die Registry sowohl der Server als auch der Client, jedoch kann der Client aus einer CAB-Datei des Betriebssystems extrahiert werden.</li>
</ul>
<p>Auf der <a href="Loop.htm">Loop</a>-Seite können Informationen zu <a href="Block.htm">Blöcke</a>, <a href="Break.htm">Break</a>, <a href="Continue.htm">Continue</a> und A_Index gefunden werden (weil diese in jeder Schleifenvariante vorkommen).</p>
<h3>Siehe auch</h3>
<p><a href="Loop.htm">Loop</a>, <a href="Break.htm">Break</a>, <a href="Continue.htm">Continue</a>, <a href="Block.htm">Blöcke</a>, <a href="RegRead.htm">RegRead</a>, <a href="RegWrite.htm">RegWrite</a>, <a href="RegDelete.htm">RegDelete</a>, <a href="SetRegView.htm">SetRegView</a></p>

<h3>Beispiele</h3>
<pre class="NoIndent"><em>; Beispiel: Löscht den Link-Verlauf im Internet Explorer.</em>
Loop, Reg, HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\TypedURLs
    RegDelete</pre>
<p>&nbsp;</p>
<pre class="NoIndent"><em>; Beispiel: Ein funktionierendes Testscript:</em>
Loop, Reg, HKCU\Software\Microsoft\Windows, R KV  <em>; Ermittelt rekursiv Schlüssel und Werte.</em>
{
    If a_LoopRegType = "key"
        Wert := ""
    Else
    {
        RegRead, Wert
        If ErrorLevel
            Wert := "*error*"
    }
    MsgBox, 4, , %a_LoopRegName% = %Wert% (%a_LoopRegType%)`n`nWeiter?
    if A_MsgBoxResult = "No", break
}</pre>
<p>&nbsp;</p>
<pre class="NoIndent"><em>; Beispiel: Ein funktionierendes Beispiel, um die komplette Registrierung
; rekursiv nach einem bestimmten Wert zu durchsuchen.</em>
RegSuche("Notepad")
return

RegSuche(Ziel)
{
    RegSucheFortfahren := true
    Loop, Reg, HKEY_LOCAL_MACHINE, KVR
    {
        Gosub, RegEintragUntersuchen
        if !RegSucheFortfahren  <em>; Sagt uns, die Suche zu stoppen.</em>
            return
    }
    Loop, Reg, HKEY_USERS, KVR
    {
        Gosub, RegEintragUntersuchen
        if !RegSucheFortfahren  <em>; Sagt uns, die Suche zu stoppen.</em>
            return
    }
    Loop, Reg, HKEY_CURRENT_CONFIG, KVR
    {
        Gosub, RegEintragUntersuchen
        if !RegSucheFortfahren  <em>; Sagt uns, die Suche zu stoppen.</em>
            return
    }
    <em>; Hinweis: Ich glaube, dass HKEY_CURRENT_USER nicht durchsucht werden muss,
; wenn HKEY_USERS durchsucht wird.  Außerdem ist HKEY_CLASSES_ROOT die Kombination von
    ; HKEY_LOCAL_MACHINE und HKEY_CURRENT_USER, daher müssen nicht alle drei durchsucht werden.</em>
    return

RegEintragUntersuchen:
    if A_LoopRegType = "KEY"  <em>; Entfernt diese zwei Zeilen, wenn die Schlüsselnamen auch überprüft werden sollen.</em>
        return
    RegRead, RegWert
    if ErrorLevel
        return
    if InStr(RegWert, Ziel)
    {
        MsgBox, 4, , Die folgende Übereinstimmung wurde gefunden:`n%A_LoopRegKey%\%A_LoopRegSubKey%\%A_LoopRegName%`nWert = %RegWert%`n`nWeiter?
        if A_MsgBoxResult = "No"
            RegSucheFortfahren := false  <em>; Sagt unserem Aufrufer, die Suche zu stoppen.</em>
    }
    return
}
return
</pre>

</body>
</html>
